<!DOCTYPE html>
<html>
<head>
    <title>Shot Tracer - tracking.js WORKING VERSION</title>
    <style>
        body { margin: 0; font-family: Arial; background: #000; color: #fff; overflow: hidden; }
        #container { display: flex; max-width: 1200px; margin: auto; height: 100vh; }
        #videoPanel { flex: 1; position: relative; background: #111; }
        #video, #canvas { width: 100%; height: auto; max-height: 100vh; display: block; }
        #controls { 
            position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.9); 
            padding: 15px; border-radius: 8px; backdrop-filter: blur(10px);
        }
        #stats { 
            position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.9); 
            padding: 15px; border-radius: 8px; font-size: 14px;
        }
        canvas { position: absolute; top: 0; left: 0; pointer-events: none; }
        button { 
            background: linear-gradient(45deg, #333, #555); color: white; border: none; 
            padding: 10px 16px; border-radius: 6px; margin: 4px; cursor: pointer; width: 100%; 
            font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        button:hover { background: linear-gradient(45deg, #555, #777); }
        input[type="checkbox"] { margin-right: 8px; transform: scale(1.3); }
        label { display: block; margin: 8px 0; cursor: pointer; font-size: 15px; }
        #status { font-weight: bold; color: #0f0; font-size: 16px; }
    </style>
</head>
<body>
    <div id="container">
        <div id="videoPanel">
            <video id="video" width="640" height="480" controls playsinline muted></video>
            <canvas id="canvas"></canvas>
            
            <div id="controls">
                <div style="font-weight: bold; margin-bottom: 12px; font-size: 18px;">üéØ Shot Tracer</div>
                <input type="file" id="upload" accept="video/*">
                <br><br>
                <label><input type="checkbox" id="trace" checked> ‚ú® Show Trail</label>
                <label><input type="checkbox" id="detect" checked> üîç Detect Ball</label>
                <br>
                <button id="playBtn">‚ñ∂ PLAY</button>
                <button id="clearBtn">üóëÔ∏è Clear</button>
            </div>
            
            <div id="stats">
                <div>FPS: <span id="fps">0</span></div>
                <div>Points: <span id="points">0</span></div>
                <div id="status">Upload video to start</div>
            </div>
        </div>
    </div>

    <!-- tracking.js CDN - WORKS INSTANTLY -->
    <script src="https://trackingjs.com/assets/tracking-min.js"></script>
    
    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const upload = document.getElementById('upload');
        const traceCB = document.getElementById('trace');
        const detectCB = document.getElementById('detect');
        const playBtn = document.getElementById('playBtn');
        const clearBtn = document.getElementById('clearBtn');
        const statusEl = document.getElementById('status');
        const fpsEl = document.getElementById('fps');
        const pointsEl = document.getElementById('points');
        
        let tracker = null;
        let trajectory = [];
        let isTracking = false;
        let frameCount = 0;
        let fpsCounter = { last: 0, frames: 0 };
        
        // üî• tracking.js WHITE BALL DETECTOR
        function initTracker() {
            tracker = new tracking.ColorTracker(['white']);
            
            tracker.on('track', function(event) {
                if (!detectCB.checked || !event.data.length) return;
                
                // Get best (largest) white blob = golf ball
                const bestRect = event.data.reduce((best, rect) => 
                    rect.height * rect.width > best.height * best.width ? rect : best
                );
                
                const ballX = bestRect.x + bestRect.width / 2;
                const ballY = bestRect.y + bestRect.height / 2;
                
                trajectory.push({ x: ballX, y: ballY, time: frameCount });
                
                // Keep only recent 100 points
                if (trajectory.length > 100) trajectory.shift();
                
                pointsEl.textContent = trajectory.length;
                statusEl.textContent = `‚úÖ Tracking Ball (${trajectory.length} pts)`;
            });
        }
        
        // üé® DRAW TRAIL & BALL
        function drawOverlay() {
            ctx.save();
            ctx.shadowColor = '#00ff44';
            ctx.shadowBlur = 15;
            
            // Draw trail
            if (traceCB.checked && trajectory.length > 1) {
                ctx.strokeStyle = 'rgba(0, 255, 68, 0.9)';
                ctx.lineWidth = 6;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.shadowBlur = 25;
                
                ctx.beginPath();
                ctx.moveTo(trajectory[0].x, trajectory[0].y);
                
                // Smooth curve
                for (let i = 1; i < trajectory.length; i++) {
                    const t = i / trajectory.length;
                    const prev = trajectory[i - 1] || trajectory[0];
                    const curr = trajectory[i];
                    const smoothX = prev.x + (curr.x - prev.x) * t * 0.3;
                    const smoothY = prev.y + (curr.y - prev.y) * t * 0.3;
                    ctx.lineTo(smoothX, smoothY);
                }
                ctx.stroke();
            }
            
            // Draw current ball position
            if (trajectory.length > 0) {
                const ball = trajectory[trajectory.length - 1];
                ctx.shadowBlur = 30;
                ctx.shadowColor = '#ffff00';
                ctx.fillStyle = '#ffff00';
                ctx.beginPath();
                ctx.arc(ball.x, ball.y, 15, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.shadowBlur = 50;
                ctx.shadowColor = '#ffffff';
                ctx.fillStyle = '#ffffff';
                ctx.beginPath();
                ctx.arc(ball.x, ball.y, 8, 0, Math.PI * 2);
                ctx.fill();
            }
            
            ctx.restore();
        }
        
        // Main loop
        function processFrame() {
            if (!isTracking) return;
            
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            if (tracker && detectCB.checked) {
                tracker.track(video);
            }
            
            drawOverlay();
            
            frameCount++;
            fpsCounter.frames++;
            const now = performance.now();
            if (now - fpsCounter.last > 1000) {
                fpsEl.textContent = Math.round(fpsCounter.frames * 1000 / (now - fpsCounter.last));
                fpsCounter.frames = 0;
                fpsCounter.last = now;
            }
            
            requestAnimationFrame(processFrame);
        }
        
        // üéß EVENTS
        upload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                video.src = URL.createObjectURL(file);
                trajectory = [];
                statusEl.textContent = '‚è≥ Loading video...';
                console.log('‚úÖ Video loaded:', file.name);
            }
        });
        
        video.addEventListener('loadedmetadata', () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.imageSmoothingEnabled = false;
            statusEl.textContent = '‚úÖ Ready! Click PLAY';
        });
        
        video.addEventListener('play', () => {
            isTracking = true;
            initTracker();
            processFrame();
        });
        
        video.addEventListener('pause', () => isTracking = false);
        
        playBtn.addEventListener('click', () => video.play());
        clearBtn.addEventListener('click', () => {
            trajectory = [];
            pointsEl.textContent = '0';
            statusEl.textContent = 'üóëÔ∏è Trail cleared';
        });
        
        // Mobile fixes
        video.playsInline = true;
        video.muted = true;
        
        console.log('üöÄ Shot Tracer with tracking.js loaded!');
    </script>
</body>
</html>
